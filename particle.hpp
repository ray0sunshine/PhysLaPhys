/*
           ````../shmdhyo+///++:::::://:--...`````.````      `  `   `      ````````````....---:://++//://////////////////:+/:-..```````         ````````...--::/::::::::/o:s/+/:::::::///oydNmo-.```    
            ````...-:+ydNNmdyooo::::::://:--...````````````             ````````........---://+++////////////////////////:+/:-...``````````` ```````.`....--://-:::::/ohd+oo/+//////++shmNNNh/-..```   `
             `````..--::/oyhmNho+:::::::://::--....``````````````  `````````...---------:://++/////////////////////::y+//:+/:--...``````````````````....--:/+/:::::+ymmmo:y/o++++++sdNNNNNh+/--.```     
              ``````...--:::/+oo+/:+/::::::///:---....````````````````````..---o::/:::://+++//////////////////////::/y+///o+::--....``````````````....--::/+/:::/ohmmmmh:/o+o+++ohmNMMMNdso+:..````     
              ````````....---::/+o:/o+/::::::///::--.....````````````````..-::/o::+-:+++oo///////////////////////:::/y//:/o+/::--.....`````````.....---:/++:::/ydmmmmmm+://oo+ohNNNmdyso++::-.`````     
        `     `````````....---::/+/:/++s/::::::///::--.....``````````.....-://oo::::+oss+///////////////////////::::/s//::o+//:----..............----://+/::+ymmmmmmmmd:::+o+oysoo++//::--..```````     
              ``````````....---:/++:::+mmh+:::::::+/::--.................--://y+:::/+ys+///////////////////////:::::+o///:oo+/:::---............---::/++::+hmmmmmmmmmms:::o++/////:::---...````````     
              ``````````....---:/++-::+mmmmds/:::::+//:---.............---:/+/y+::::/s/////////////////////////::::/s+///+so++//:::------...-----::/++/:/ymmmmmmmmmmmm/::/o+//::::----....``````````    
            ```````````.....--::/+o-::/mmmmmmdy+::::++/::----.......-----://++h+::::://///////////////////////:::::+y////ooooo++///::::--------::/++/:-:o++sdmmmmmmmmy:::o++/:::----......````````````` 
          `````````````....----:/+o::::mmmmmmmmmho/::++//::-------------::/+o+ho:::::////////////////////////:::::/ys++++++++/+++++//:::::--::://++::-....../mmmmmmmm/::/o+//:::----......``````````````
   ```````````````````.....---:://+/:::ymmmmmmmmmd+.-:+++/:::--------::://++o+hy/::::///////////////////////:::::/syoooooo++++++++oo+///::::://+o/::-.`....--dmmmmmms:::+o+//:::----.......`````````````
````````````````````......----:://++:::+mmmmmmmmm/....:/o++/::::::::::::/+oosoyhs:::::++++++++++////////////:::::oysoooossssssssssso++///////++o/::.```...--:mmmmmmm/:::o++//:::-----.........`.````````
``````````````````.......----::://+o::::ymmmmmmmm-...`.-:+o+///:::::////oo+oss+yho::::/++++++++++++//+++++/:::::+ysossssssssssssss+o++/////++o+:::.````..---smmmmmmy:::+o+///::::------..........```````
``````````````.........-----:::://+o/:::/dmmmmmmm-....``-:/+o+////////+/oyssssooyyo:::/+++++++//+ss///++++/:::/oyssssossssosssssoooo+++/+++oo+::-.```..----:dmmmmmm+:::oo+///:::::::-----............```
````````..........-.------::::////+o+::::ommmmmmm:--...``.-:+oo+//////+++osyyyysoyyo:::+ooo+//:::o+::::/++:::/ssosssyosssoossssoosoo+++++ooo/::-.```..-----smmmmmms:::+o+++///////:::::-------..........
`................-----::::///////+++o/::::ymmmmmms----..``.-:/oo++////++oo+osssssoyyo::/oo+::::::/:::::://:++soososhmoshyssoossssoooo+oooso/::-..``..-----/mmmmmmh::::oo++++++++++++///::::------.......
............------:::////++oosssso++oo:::::hmmmmmd:----..```-::+oo+++++++ooossssososy+:://:::///+oo++///:/+s++ossydNhdNmmmmhyyysssoooosss+::--::-..-------hmmmmmd/:::+o++++ossyhhhysoo++///:::------....
.........------::://+osyhdmNNNdhso+++o+::::/dmmmmmy-----...``.::+soo+++++ooosssossysoso/::/+ossyyyyyysss/:++syhddmmdNNNNNNNNNmmhsoossss+/::-::::/.-------ommmmmm+:::/oo++++sdNNNNNNNNmdyso+//::::-------
.....-------:::/+oydmNNNmdysoo++////++o/::::/dmmmmmo------..`--::/oooo+++oooooosssssso++//syyydyyyymhyyys+syhddmmdhmNNNNNNNNNNmysssss+::::-:::/+/.------+mmmmmmo::::oo++++++osyhmNNNNNNNNmdyo+//:::-----
-----------::/ohmmmdhyso++++////////+++o/::::+dmmmmmo-------.::--:/osooooooso+yhhyyyyyhhssydhyNdyyhNNmddNmdmmdddmmdhdddNNNNNNdyyyys+::--/:::/+o+-------/dmmmmmo::::oo+++//+++++ooossyyhhddmmmmhs+/:::---
----------:/syyso++++/////////////////++o/::::+dmmmmms-------+:::--:+ssoooss+soohdmNmNNmdmdsoodNdyhNdmNNmhddmmNNNNNmmddNNNNmhyhyo/:--:::::/+oshso/:---/dmmmmdo::::/so++////////+++++++++++++++ooo+//::::
-------::::////////////////////////////++o/::::/hmmmmms------+++::--::osssss+oyhhyddhNNNNy+++oomNmmNNshd+oyymsdhmmmmNNNNNmhyhy+:---::::/++ooo+:smNNdo+mmmmmy/:::::/oo++/////////////////////////////////
::::::::////////////////////////////////++o/:::::odmmmmy-----/ooo/::+--/oyyyyyyydNdmNNNhsohho:/+dNNNNh/-/ymmNNdhdNNNNNNmdsyo/--....-:/+++++/:----/shdNNmdy+::///::::+++/////////////////////////////////
//////////////////////////////////////////+o+:::::/ymmmmh:---:ohdho/::--:/osyhdNNhdddhho+yNmN+:/+yNNdos+ydmdshhyydmNmddds+:--.....---------------:odmds+::::/ossso+/:+++////////////////+///////////////
///////////////////////////////////////////+oo/:::::+hmmmd+odNmhhooo++/::-:/ymNNNNNmdmyoo+dmmdyhssymNNmssmh+oshddNdyyyo/:-....----------------/osys+/:::::::/+o++oooo/++////////////+++ys///////////////
////////////////////////////////////////////+oo:::::::+ymNNdyo/--:/+++/:-..--:+yhdddNdmmysoshNmmNsodmddds+/+hNNmhhNmo++o/::--:---:::://+++++++//:::::::::/+oo+++++++++++++++++++++++ooyNy++/////////////
/////////////////////////////////////////////++::++o+/:::ohmh/-------------...-:oysNmdNNNNdo/sMMMNhNNMMNo/ommNNNNho/ohmmmmmmmmmmmmmdyyyyss+::::::::::://++++//////////++ohysoooooosssyNNyo+/////////////
//////////////////////////////////////////////:/++oo/:::::::+ys+:----------------:+hshhyNNNNh+yMMNmdddmy:smNdsyy+/ohmmmmmmmmdhys+/:::ohhhhhs/::::://+++++/////////////+++yNNNmdhyyyyhNNNyo++////////////
/////////////////////////////////////////////////++++o+/:::::::/osyhhhhhhhddmmmddhs//shdddhyshyyhmMNNmyoohhyyy//odmmmmdhys+/::::::::::+ooooo+++++++++/////////////////++ooyNNNNNNmhmNMNNyso+////////////
//////////////////////////////////////////+o/////////+++++//::::::/syyhhdmmmmmmmmmmmy+/oyhhsyhyo:/+so//oohhhs/sdmdys+///+++oooooooooooo++++++++///////////////////////++oosydNNNNNNNNNNNyso++///////////
///////////////////////////////////////++ymo/////////////++++++///oyyhys://+osyhdmmmmmho/+yso+/::/:+////+o+/odhs/::::/syyysssoo+++++++////////////////////////////////+++osyyhmmNNNNNNNNyyo++///////////
////////////////////////////////////++oymNh+/////////////////++++oooooo+///:::::://+syhdho/::::::::+::::::/ys+:/s::::::+o/+soo+++////////////////////////////////////+++oosyhhdmNNNNNNNmhyso+///////////
/////////////////+oo++++/////////+++oymNNh++/////////////////////++++ooosssso//+::::::/:/+o+:-://////::-:++::ooy+:::::::::++oo++////////////////////////////////////+++oosyhhdNNNNNNNNNmNhso++//////////
///////////////+oyNNhsoo++++++++++oymNNdo++//////////////////////////+++ossoo/:::::::::::::::-:s////++:-::::::/:::::::/oyhh/+o++//////////////////////////////////+++oosyyhdmNNNNNNNNNNdmmdso+//////////
//////////////+osNNNNmhysooo+++ooohNNdso++////////////////////////////++ooo/yhhs+/:::::::::::::/o::/+::::///::::::/oydhyo//://++////////////////////////////////+++oossyhhmNNNNNNNNNNNNhhyyyo+//////////
/////////////+osyNNNNNNmhyyssssssdNmyo+++//////////////////////////////++//::/+syhy/o::://+o+:::/+++::::/+ooo+:o+odhs+/:::::::++///////////////////////////////++oossyhhdNNNNNNNNNNNNNdhysoo+///////////
/////////////+oshNNNNNNNNdhhyyyymmhsoo++///////////////////////////////+++::::::///oo::+ossshds/:/oso++sssooo::so+/::::::::-/+++////////////////////////////+++oossyhhdNNMNNNNNNNNNNNNhhyso++///////////
////////////++oyhNNNNNNNNNNddhdmdyssoo++///////////:////:///////////////+oo/:::-::/hs::syhdNMMMmyoshhmNNNmdhy:+hdso:::::::::oo++///////////////////////++++++oossyhhdNNNNNNNNNNNNNNNNmhyso++////////////
////////////++oyhNNNNNNNNNNNNmmdhyysoo+++///////////////////////////////+oo+:::::::yN//NNMMMNmdhysshmMMMMMMMy:dMmsyo+s/::::::o++/////////////////+++++oooooosssyhhdNNNNNNNNNNNNNNNNNNdhyso++////////////
////////////++oyymNNNNNNNNNNNNNmdhhysso+++//////////////////////////////+oo::::::o++hy/yNmdyssossssssyhmNNNy/hNdssssooy+:::::/o++///////////++++ooossssyyyyhyyhhdmNNNNNNNNNNNNNNNNNNNhysoo+/////////////
::://///////++osydNNNNNNNNNNNNNNNNdhyysoo+++////////////////////////////+o::::::+ssyyy++o/:ossssssssssoos+++ysyssooooooso/::::/o+++////+++++oosssyyhhdmmNNNmhhddmNNNNNNNNNNNNNNNNNNNdhyso++/////////////
:::/:///////++osyhNNNNNNNNNNNNNNNNNmhhyssoo+++++///////////////////////+++:::::+sossyyoos//ossssssssssss+:/ysssoo++++oooos/::::+o+++++++oosssyyhdmmNNNNNNNNddddmNNNNNNNNNNNNNNNNNNNNhhyso++/////////////
::::/:///////+osyhmNNNNNNNNNNNNNNNNNdhhyyssooooo+++++//////////////////+o:::::+sossssss+s:+sssyyhdhyssss/:oossoo+++++++oooso/:::+oooooossyyhhmmNNNNMMMNNNNddddmNNNNNNNNNNNNNNNNNNNNdhyso++//////////////
:////////////++osyhNNNNNNNNNNNNNNNNMNddhhyyyyyyysssooo++++////////////+o/:::/ososooosss+o:oshmNMMMMNdyso:+hosoo+++++++++ooooyo/:/osssyyyhdmNNNNNNNNNNNNNNmddddNNNNNNNNNNNNNNNNNNNNmhhyso++//////////////
://///////////+osyhdNNNNNNNNNNNNNNNNNNdddddmmmmddhhyyssooo+++++/////++oo:::/ooooooooosy+o:hNMMMMMMMMMNdo:hsssoo+++++++++ooosoys///oyhhhmNNMMNNNNNNNNNNNNmdddmmNNNNNNNNNNNNNNNNNNNNhhysoo++/////////::///
::::/:////////++osyhdNNNNNNNNNNNNNNNNNmmddNNNNNNNNNmdhhyyssooo+++++++oo/::/soooooooooss+s:NMMMMMMMMMMMMo/hsssooo++++++oooossssho//+ohmNNNNMMNNNNNNNNNNNmddddmmNNNNNNNNNNNNNNNNNNNdhhysoo++///////::///::
::::::////////++osyyhmNNNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNmdhyysssoooooo+::::/sosoooooosssoy/NMMMMMMMMMMMN/ssyssooooooooossssyyyshy+++smNMNNNNNNNNNNNNNNNNddddddNNNNNNNNNNNNNNNNNNNdhhyssoo++///////:::::::
:::::::://////++oosyhhmNNNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNNNmdhhyyysso//////oossooooosssosy+MMMMMMMMMMMMm/hsysssssssssssyyyhdmmhyhooyNNNNNNNNNNNNNNNNNNNdddddddNNNNNNNNNNNNNNNNNNmdhhysssoo+++//////::::::
:::::::///////+++ossyhdmNNNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNNNNNmdhhho//////+yossssosssysshyoMMMMMMMMMMMMd+myyyyssssyyyyhdmNNNNNdhdysNNNNNNNNNNNNNNNNNNNdddddddmNNNNNNNNNNNNNNNNNddhhyyyysyssoo++///////:::
::::::://////+++oossyyhdmNMNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNNNNNNmds+++//yyyosyysssssyssyNosMMMMMMMMMMMMh+NhhyyyyyyhhhmNNNNNNNmddhdmNNNNNNNNNNNNNNNNNNddddddddNNNNNNNNNNNNNNNNmddhhhhhhhdmNmysoo+/////////
::::///////++ooossssyyyhddNNNNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNNNNNNyo++++hNNds+oyyyyyysymN+yMMMMMMMMMMMMh+NNhhhhhhhdmNNNNNNNNNdddddNNNNNNNNNNNNNNNNMNddddddddmNNNNNNNNNNNNNNmddhhhhhhhdNNNNMNdyso++///////
://///////++osdNmyyyyyyhhhdNNNNNNNNNNNNNNNNNNmmmmNNNNNNNNNNNNNNNNNhoooshNNNNmyyhhhhshmMd+dMMMMMNNMMMMMd+NMNhddddmNNNNNNNNNNdddddmNNNNNNNNNNNNNNNNNdddhhhdddNNNNNMMMNNNNmdddhhhhhhddNNNNNNNNNmyso+///////
:////////++oymNNNNdhyyyyyhhdmNNNNNNNNNNNNNNNNNmmmmmNNNNNNNNNNNNNNNNdsyhshNNNNNNmddyhmMMy+mMMMMMhhNMMMMd+mMMNddmNNNNNNNNNNNmdddddmNNNNNNNNNNNNNNNNdddhhhhddNNNNNNNNNNmddhhhhhhhhhdNNNNNNNNNNNNdyso+//////
:///////++osdNNNNNNmhhhyyyhhhddNNNMNNNNNNNNNNNNmmmmmmNMNNNNNNNNNNNNNmddddmNNNNNNNdhNMMNsoNMMMMMdyhNMMMmohMMMNmNNNNNNNNNNNmddddddNMNNNNNNNNNNNNNNddhhhhhhhNNNNNNNNNdhhhyyyyyhhhdNNNNNNNNNNNNNNNyyo++/////
:///////+osymNNNNNNNmhhhhyyhhhhddmNNNNNNNNNNNNNNmmmmmmmNNNNNNNNNNNNNNNddddNNNNNNNNNNMMmooNMMMMMNhdNMMMmosMMNNNNNNNNNNNNNmddddddNNMNNNNNNNNNNNNmyso+so+yhNNNNNNNmdhyyyssssyyhmNNNNNNNNNNNNNNNNNdyso+/////
:///////+oshNNNNNNNNNNmdhhyyyyyhhhhdmNNNNNNNNNNNNNmddddmmNNNNNNNNNNNNNNmddmNNNNNNNNNNMhooNMMMMMMNNMMMMNssmNNNMNNNNNNNNNmddddddNNNNNNNNNNNNNNmyo++os///oNNNNNNdhyysssooooshmNNNNNNMMMNNNNNNNNNNNyyo++////
///////++sydNNNNNNNNNNNNNmdhyyyyyyyhhhdmNNNNNNNNNNNmmdddddmNNNNNNNNNNNNNmddmNNNNNNNNNNysodMMMMMMMMMMMMmsshNNNNNNNNNNNNNddddddNNNNNNNNNNNNNmyoossso+/:+mNNNmhyyssooo++++oossyhddmmNNNNNNNNNNNNNNdyso+////
///////+osymNNNNNNNNNNNNMNNNmmdysssssyyyhhdmNNNNNNNNNNmhhdsymNNNNNNNNNNNNddmmNNNNNNNNNmhshMMMMMMMMMMMMdsyNNNNNNNNNNNNmddddddNNNNNNNNNNNNdyssso+////:ommdhysssoo+++++++++++ooossyyyhhddmNNNNNNNNNyso+////
///////+osyNNNNNNNNNNmmdhyysssssso+oooosssyyhhdmmNNNNNNmhdhysydNNNNNNNNNNNddddmNNNNNNNNNhsNMMMMMMMMMMNyhNNNNNNNNNNNNmddddddmNNNNNNMNmmdhhso///:::o:://:+sooo+++++////////+++++oooosssyyyhdmNNNNNdso+////
///////+osyNNNNNNNNdhyyssoooo++++++++++++ooosssyyyhddmmNNdsyyhhhdmNNNNNNNNNddhmNNNNNNNNNNyhmNMMMMMMMNhdNNNNNNNNNNNNNddddhhmNMNNNmddhhyyyyy+:::::/ooysoooo+++++/////////////////+++++ooossyyhmNNNNyo++///
:://///++shNNNNNmhyysoo+++++/////////////+++++ooossssyyssyho+++osyyyhddmNNNNdmMMNNNNNNNNNNyssyhdmmmhydNNNNNNNNNNNNMMmhhhhdNNmhso++syyysssy:::::::+sssoo++++/////////////////////////+++++oossyNNMmo++///
/:://///+ohNNNNdysoo+++///////////////////////+++++ooosssyso///////ohhhhhhdmNNMMMMNNNNNNNNNyhsooosssdNNNNNNMMNNNMMMMMdhhhdhhho//::/sssssss:::::::/oooo+++++//////////////////////////////+++ooymNNs+////
::::////+oyNNNyso+++//////////////////////////////++++oosso/////:::/yyyyyhhdNNNMMMMmsmNNMMNmhyooooymNNNNNNNNdmMMMMMMMNyyyyyyyo:////ssoooos+::::---:++oo+++++++++////////////////////////////+++odNh+////
::///////+oNms+++///////////////////////////////////+++ooo+/:://:::/yyyyyyyNMMNNMMNssMNNNNNNdsooohNNNNNNNNNNsyNMMMMMMMmyyyyyys:::::ssooooooo/:--..-:+soooo+++++++++++++/////////////////////////+yh/////
///////////s+////////////////////////////////////////++++/:::::::::osssyysdMMMMMMMd+hMMMMNhmmyyhhNNmNNNNMMMMd+hNMMMMMMMhyyyyyy+::::+ssoooooss/-:...:hdysssssssssooooooo+++++////////////////////////////
:::://///////////////////////////////////////////////+++::-.-:::::+ssssyysNMMMMMNdo/hMMMMMyyyyhhhhyymMMMMMMMm++oymNMMMMNsyymmdy/::::osssssssss::...oyhNNmddhhhhhhyyyyysssooo++++//////////////////////::
::::///::::://///////////////////////////////////////++o:-.`-:-::syyyyss+dMMMMmy+///+hMMMMsyyyyyhhhyyMMMMMMMs/++//odNMMMdyhhNNNd+:/::/osssssso::-.-syyydNNNNNNNNNNNmmddhhyyssooo++++///////////////::://
://:/://::::////////////////////////////////////////++oo/.`.:::/+yyys//:+NMMms////+///dMMNsyyyyyyyhhydMMMMMm//sdy+//+ymMNyhhdNNNms/:::::--::::::/.:yyssyydNNNNNNNNNNNNNNNmdhhyyssoo+++/////////////::///
://:::::::/:://////////////////////////////////////+++os/`.-:-+o+/+:----hMNy/://ohdo//+NMmyyyyyyyhhhhymMMMMs//dsoyy+//+smhyhhhNNNNdo///:::::::-/s-:yyyyyyyhdNNNNNNNNNNNNNNNNNmdhyysso+++/////////////://
:::::::::::////////////////++++++++ooooo++++++++++++ooso..-::-..-...----md+::/shyosm+//hMhyyyhhhdmdhhhymMMN+/+d///+yy+///yshhhhmNNMNdyo++////::+y/:yyyyyyyyhhdNNNNNNNNNNNNNNNNNNmdhyysoo++//////////////
/:::::::::///////////+++++ooosssssyyyyyhhhhyooooooossyh/.-::-..-::-::::/y/:/shy+://hh//sNyhhhhmNNNNmhhhymMd//yh/////+yy+/osyyyyhdNNNNNNNmddho//syo:hNmhhyhhhhhhdNNNNNNNNNNNNNNNNNNNmdyysoo++////////////
//:///////////////+++oosssyyhhddmmNNNNNNNmhssssssyhdmNNo.::--:.-:::/+os/::+hy+::://+mo+sdyhhdNMNNNNNNdhhymy//ds/////:/ohy+yoyyyyyhmNNNNNNNNNd++yhy:oNNNNdhhhhhhddmNNNNNNNNNNNNNNNNNNNmdhyso++///////////
:://///////////++oossyyhdmmNNNMNNNNNNNNmhyyyyyyhmNNNms/:--::::-//sddhhh::oho:::::://dhssyhhdNNNNNNNNNNhhhyss+m+///:::://sdhoyyyyyyyhdmNNNNNNNmshhh+/hNNNNNmdhhhhdddmNNNNNNNNNNNNNNNNNNNNdhyso++/////////
:://////////+++ossyhdmNNNNNNNNNNNNNNNdhhyyyhhmNNNNNNo::o/////odNNNhyyyy/sh/:::::::/:ymsohddNNNNNNNNNNNmhhhsysm+///:::://:+dhyyyyyyyyyyhmNNNNMMNhhho/+mNNNNNNmddddddddmNNNNNNNNNNNNNNNNNNNNdysoo+//////:/
//////////++oosyyhmNNMNNNNNNNNNNNNmdhhhhhhhmNNNNNNNy:/yo///+hNMNmhyyyyyoy/:::::::::/sNsshhNNNNNNNNNNNNNdhhhssN////::://///+hdmhyyysssyyyydmNNNNNhhy//omMNNNNNNmdddhhhdddmNNNNNNNNNNNNNNNNNNNdyso++//////
:///////++oosyhdmNNNNNNNNNNNNNNNmdhhhhhhhdNNNNNNNNh//yho/+yNNNNdyyyyyyy+/::::::::::/sNohhhNNNNNNNNNNNNNNhhhyom+//::::::////yyNNmyyysssssyyyyhdNNNhy+//omNNNNNNNNNddhhhhhhhddmmNNNNNNNNNNNNNNNNhso++/////
///////++osyhdNNNNNNNNNNNNNNNNmdhhhhhhhhdNNNNNNNNd//ohhoodNNNmhyyyyyyymy/::::::::::/sdyhhhNNNNNNNNNNNNNmhhyyyhoo//:::::////syNNNNdyyyssssssssyyydmy++//+dNNNNNNNNNmdhhhhhyyhhhhhddmmNNNNNNNNNNNmyo++////
//////+ossydNNNNNNNNNNNNNNNNNdhhhyyyhhhmNNNNNNNNy///ohyhNNNmhyyyyyyyhNNh///::::::::ossyyyhdNNNNNNNNNNNNdhyyyyhdyo/:::::////oymNNNNmhyysssssssssssyy+///:/yNNMNNNNNNNmhhyyyyssssyyyyyyhhdmmNNNNNNNyo+////
////++osyhmNNNNNNNNNNNNNNNNmdhhyyyyyhhmMNNNNNNd+:://oydNNmhyyyyyyyyhNNNd+///::::::/s+yyyyhhNNNNNNNNNNNNhyyssssddyo/::::////+hhNNNNNNhyysssooooooosss////::/hNNNNNNNNNNdyyysssooooooosssssssyhdmNNNh++///
///++osyhNNNNNNNNNNNNNNNNmhhhyyyyyyhhmNNNNNNdo:::///+sNmhyyssssyyydNNNNh+///::::::sossssyyhNNNNNNNNNNNdhyssoossyyso:::::////yhNNNNNNNdyyyssooooooooso:////::/yNNNNNNNNNmyyssooo++++++++++ooooooshmNd+///
//++osyhNMNNNNNNNNNNNNNNdhhyyyssyyyhdNNNNNh+/:::////:hyyssssssyyydNNNNMh+///:::::+sosoossyydNNNNNNNNNNhyssoooooososo::::////oyNNNNNNNNNhyysooo+++ooos:::://////sydNNNNNMNhsso++++///////////++++++ohh+//
/++osyhNNNNNNNNNNNNNNNdhhyysssssyyyhNNNNNm/:::///::::ysssoosssyymNNNNNNy+///::::/s+sooooosyyNNNNNNNNNdyssoo+++++oooo+::::////hdNNNNNNNNNdyysoo+++++oo+:::::::////:ydmNNNNNmso++/////////////////////////
/+osyhNNNNNNNNNNNNNNmhhyyssooosssyyNNNNNMN/:://:.-::-osoooossyymNNNNNNNy+//:::::soooo+++oosyhNNNNNNNdysso+++++++++oo+o::::///shNNNNNNNNMNmyssoo+++++oo-:::-.:/:::::yyyyyyhhho+//////////////////////:::/
++syhNNMNNNNNNNNNNmdhyssoooooossyymNNNNNMN:--:+s.-:::oooooossydNNNNNNNNy+//::::osoo++++++oosyhNNNNNmysoo++///////++oo+o:::::/+ymNNNNNNNNNNNhsso++++++o::::.`/y/:::-:ssoo++++/////////////////////////://
+osymNNNNNNNNNNMNdhyssooo++++oossdNNNNNNNd----/-.:::ooooooosyhNNNNNNNNmy//::::oy+oo++++++++ossdNMNNyso++///////////++o++:::::/yshdmmNNNNNNNNdsoo++++++/o+:-../+-:::./oo++/////////////:////:::///////:::
osydNNNNNNNNNNNdhyssoo++++++++osdNNNNmdhh+..----:::oo++++ossymNNNNNNNNyy/::::+yooo++///////++oodNNyo++//::::::::::///+o++:::::+syyyyyhhdmNNNNmyo++///++++o/:...-:::-.+o+///////////:/::/:/::::/://///:::
oshNNNNNNNNNmdhysoo++++////++++hNmdyyssys-..-:::::oo+++++ooshNNNNNNNmhso::::/ys+o+///::::::///++dh+///:::::::::::::://++o+:::::sossssosssssyhddy+/////++++++/:-:::::--+++//////////////:/:/:/::/://////:
oyNNNNNNNmdhysso+++///////////+ooo+oooos:```-:::/o+++++++oosmMNNNNmhhsy:::::sy+o+///:::::::::::////:::::::::-::::::::/+++s:----:ooso++++++++++++/////////+++++/::::::-:++/////::::::::::::::::::::::::::
omNNNmdhyssoo+++///////////////////+++o+```.:/:+++/////+++osNNNNmhhhsy+----/yoo+//::::::::::::::::::------------::::://++/+-----/+oo++//////////:::::://///++++/::::::-/++////:/::::::::::::::::::::::::
ohyssooo++++////////////////////////+++.``.:::+++////////+oyNNmhyyysss-----+y++//::::::::::::::-------------------:::://+/+--..../++o+////:::::::::::-::::://+++/::::::-/+///////::::/::::::::::::::::::
////////////////////////////////////++-``-:::++///::::://++hmhsosssoy:-----+y//::::::::::::::---------------------:::::/++o-......+o+o+///::::::::::---:::::://++:-:::::-++////////:/:::::::::::::::::::
//////////////////////::://////////++:``-:-://::::::::::///yo++ooooo/.....-oy//:::::::---------------------------:----://++/.`````.os+o+//:::::-----------:::::/++:-:::::-++///:///:///:::::::::::::::::
:/:////:/://:///////////://////////+:``.::/+/::-----::::///+++++oo+o.......+y//:::---------------................-----::/+/o```````.ss+o+///::::------------:::://+:-::::-:+//:::///:////:::::::::::::::
::::::::::::::::::::/::::///:/::///:``.--/+/:---------::://////+o+o-``````.+y++::----------........................----:/+/s:```````-so+o+//::::--------------::://+:-::::-:+/::::/::::::::::::::::::::/
::::::::::::://:/:::/::::::::::://:``.--///::---------::::::///++++````````os/+/:----------........................----:://+s````` ``-s+++//:::----------------::://+:-:::::///:::::::/:::::::::::::::::
:::::::::::://::::::::::----::://-``.--///::::::-------:::::://+/y-````````yo++/:-----.................`............----:/+/y+`       -s/+//:::-----------------:::://:-::::///:::---:::::::::::::::::::
:::::::::::://:/:::--------::://-``.--//::---------------::::/++oy`       -y/+/::--.............`...``````````.......----:/++y+`       :o++/::---------------------:://:-:::++//:::-----::::/:::::::::::
::::::::::////:::---------::://.``.--//::------------------::/+/yo       `+o///:--.....```..``````````````````.........---://sy+`       //+/::--------.-...---------:::/:-:::s///::-------::::::::/:::::
:::::///:://:::---------:::://.``---//:-----......---------::/++y/       -o//::---......```````````````````````.........--:://sy/       `://::------.............-----::/:-::os///:::-------------:/:://
::::////////:----------::://:``./--/::---..........--------:///oh-      `+///:---.......````````````````````````.........--:://sy:       `:/::---....--...........-----::/--:oys///:::-------------:::::
::://////:::---------:::://-``-o:-/::---............-------:://yh.      //+/:---........````````````````````````.........---:://oy:       ./::--...........--......-----::/--oyys///:::-------------::::
://////::-----------::://:.``:s/:/:----.............----.--:://yy`     -///:---........````````````````````````````.......---:://oy-      `//:--............--.......----://-oyyyo///:::--------------::
///:::::----------:::///-```/s+:/::---........-..........--:://hy`    .///:-----.......`````````````````````````````````....--::/++s.      :/:--..........`.........------://+syyyo///:::---------------
:/:-------------:::://:```.+so:/::--.....................--::/+hy    `///:--....``````````````````````````````````````````....--:///s.     -/:--.........````.......--.----://oyyyyo//::--::------------
::-------------::::/:.```.sso:/::---...---...............--::/+hs    ::/:--....```````````````````````` ```````````````........--:///s`    `/::--........`.```.........--::://:syyyyo///:---------------
-------------:::///-````-sso//::---...--..`..``.........----:/oho   `:/::-.......````````````                        ``````.....--://+o`    /::-.......`...`````..........--:://syyyyo://:-------::-----
-----------:::///-`````-oso//::---........```.`...........--:/oy+   .//:--...````````                                 `````````...-://so    -/:-.....```````.````..........--://+yyys+-://::------------
----------:::///.`````-+so//:::--.......`.``.````...``....--//sy:   ./:-..`````````                                    ``````````..-:/:y/   `/:--....`````````````.........---://oyys/:o///::-----------
--------:::://-`````.:/so//::--.......````...`````````....-://sy.   -/--...``````````                                      ``````...-:/+y.   ::-...`````..`````````.........--:://sys/:ss://::--------::
-----:---:://.`````-::o+//:---.........``````````````.....--/:yo    ::-..```````         `     ``````    ```````````````  `````````..-/:so   ./:-..`````````````````........---:://ss::sy:-://::--------
--------::/:`````.-::o+//:--..........`````````````````...-://y.   ./:-..```````   ``                                     ``  `````..-://y.   ::-..`````````````````````......--:///s:/ss::--//::------.
--:----::/:`````.-::++//:---.........``````````````````..--:/o/    :/-.````                                                     ````.-://h/   ./:-.``````````````````````......--://+:+ss::::-///::-----
------::/:`````-:::++//:---......``````````````````````..-://o`   `/:-.```                                                        ``..-/+ho    :/-..``````````````````````......-::///+so:::::-:///:----
..----:/:`````-:::////:--.....`````````````````````````.--::+.    `/:-.```                                                        ``..::ohs    `::-.````````````````````````.....-:://sy+::::::--//::---
..---://`````.:::+///:--.....```````````   ````````````.-::/.     :::-.```                                                       ```.-:/yhy`    `:-..`````````````````````````...--:://s+:::::::--//:::-
.---::/.``..`.::+///:-.....`````````    ``````  ``````..-::.      -+::..``                                                       ```.-:/oo:      .:-..````  ``     `   `````````...-://+o:::::::::-://:-
---::/-``:o.`-:+///:-.....``````    ````    `      ```.-:::        ./--.```                                                      ```.-:-` `       ::-.`````                ``````...-://++::-..-:::-:/:-
---:/:```/.`-:+//:--.....``````````     ``        ```.-::+`         ::-.```                                                       ```.-:` +-      ./-..````                  `.```...-://++:-`-o:-::-//:
::::/.`` ``-:///:--...```````````    `` `         ```.-//+      .  .-:-.``                                                         ``.-:-`+s`     `//-..```                   ``````..-://++:-`+s-:::-//
--:/-````.-:///:-..`````````                     ```.-:/+.     :+  ::-.``                                                          ```.-:`yo+      .:/-..```                   ` ````..-://o+:-.-.-::--/
--:/````-:////:-..`````````                     ```.-:/+-      o/ `:--.``                                                          ```.-:.ooy.      `.:--.```                     ```...-://o+::--::::-:
-::-```::///:-..``````   `                     ```.-:/o/`     `o: ---.```                                                           ```.--:+o/      `  `--.``                       ``.`.--//o+::::::::-
-::```++o/::-..`````                            ``.-/o+o`     `/:....```                                                           `````..-::s/.    -o` `-.```                        ```..-/:o+::::::::
-:-``:ss/:-...````.`                           ``.--+:h-      `:-..`````                                                               ```.--:/o+-`  yo  -.``                          ````.-::o+:::::::
-:.``oo::-..``````                            ```.-:/o:    `..--.``````                                                                 ````..-:/++/-./` -.```                           ```..-:/o+:::::
-:```:::-..```                               ````.-+-` `.----..``````````                                                                 ````..---:++:.`..```                            ````..-::/+/::
--``---..````                                  ````-``......````` ``````                                                                     `````......`````                               ````..---://
.``..-.`````                                      ````````````        `                                        `                               ``````````                                     `````...--
``...```                                                                                                                                         ``` ```                                           `````
````.`                                                                                                                                                                                                 `
   ``                                                                                                                                                                                                   
                                                                                                                                                                                                        
                                                                                                                                             `                                                          
                                                                                                                   `            `.``                                                                    
SENKETSU KISARAGI! Coded this part while watching ep24 kill la kill!
DUAL SCREEN FTW!!!
*/

#ifndef PARTICS_HPP
#define PARTICS_HPP
#include <GL/gl.h>
#include <GL/glu.h>
#include <sstream>
#include <algorithm>
#include <iostream>
#include <fstream>
#include <string>
#include <vector>

enum ptype{flame,smoke,spark};

struct part{
	int life;		//remove particle when life <= 0
	int mlife;		//max frames visible
	float r,g,b,a;
	double x,y,z;	
	double vx,vy,vz;
};

std::vector<part> farts;	//fire
std::vector<part> sparts;	//sparks
std::vector<part> smarts;	//smoke
std::vector<part> swap;

void addPart(double x, double y, double z, double vx, double vy, double vz, int life, ptype tp, float r, float g, float b){
	part npt;
	npt.x = x;
	npt.y = y;
	npt.z = z;
	npt.vx = vx;
	npt.vy = vy;
	npt.vz = vz;
	npt.r = r;
	npt.g = g;
	npt.b = b;
	npt.a = 1;
	npt.life = life;
	npt.mlife = life;
	switch(tp){
	case flame:
		farts.push_back(npt);
		break;
	case smoke:
		smarts.push_back(npt);
		break;
	case spark:
		sparts.push_back(npt);
		break;
	}
}

#define f_grav 0.01
#define f_damp 0.95

#define s_grav -0.098
#define s_damp 0.99

#define sm_grav 0.001
#define sm_damp 0.995
#define sm_rad 3
#define sm_accel 0.2
void simPart(double cx, double cy, double cz){
	//clean swap
	//add still alive particles to swap
	//do work
	//swap buffer back in
	swap.clear();
	for(int i=0; i<farts.size(); i++){
		//update life and alpha, check alive
		//physics
			//accel
			//update location
		part fp = farts[i];
		if(fp.life > 0){
			fp.life--;
			fp.a = (float)fp.life/(float)fp.mlife;

			fp.vy += f_grav;

			fp.vx *= f_damp;
			fp.vy *= f_damp;
			fp.vz *= f_damp;

			fp.x += fp.vx;
			fp.y += fp.vy;
			fp.z += fp.vz;

			swap.push_back(fp);
		}
	}
	farts.swap(swap);

	swap.clear();
	for(int i=0; i<sparts.size(); i++){
		//update life and alpha, check alive
		//physics
			//accel
			//update location
		part fp = sparts[i];
		if(fp.life > 0){
			fp.life--;
			fp.a = (float)fp.life/(float)fp.mlife;

			fp.vy += s_grav;

			fp.vx *= s_damp;
			fp.vy *= s_damp;
			fp.vz *= s_damp;

			if(fp.y + fp.vy < 0){
				fp.vy = -0.5 * fp.vy;
			}

			fp.x += fp.vx;
			fp.y += fp.vy;
			fp.z += fp.vz;

			swap.push_back(fp);
		}
	}
	sparts.swap(swap);

	swap.clear();
	for(int i=0; i<smarts.size(); i++){
		//update life and alpha, check alive
		//physics
			//accel
			//update location
		part fp = smarts[i];
		if(fp.life > 0){
			fp.life--;
			fp.a = (float)fp.life/(float)fp.mlife;

			fp.vy += sm_grav;

			//move away from char
			double dx = fp.x - cx;
			double dy = fp.y - cy;
			double dz = fp.z - cz;
			double dist = sqrt(dx*dx + dy*dy + dz*dz);
			dx /= dist;
			dy /= dist;
			dz /= dist;
			if(dist < sm_rad){
				fp.vx += sm_accel * (dx/(dist+1));
				fp.vy += sm_accel * (dy/(dist+1));
				fp.vz += sm_accel * (dz/(dist+1));
			}

			fp.vx *= sm_damp;
			fp.vy *= sm_damp;
			fp.vz *= sm_damp;

			fp.x += fp.vx;
			fp.y += fp.vy;
			fp.z += fp.vz;

			swap.push_back(fp);
		}
	}
	smarts.swap(swap);
}

void drawPart(){
	glDisable(GL_TEXTURE_2D);
	/*glBegin(GL_POINTS);
	glNormal3d(0,1,0);
	for(int i=0; i<farts.size(); i++){
		part fp = farts[i];
		glColor4f(fp.r, fp.g, fp.b, fp.a);
		glVertex3d(fp.x, fp.y, fp.z);
	}
	glEnd();*/
	glBegin(GL_LINES);
	glNormal3d(0,1,0);
	for(int i=0; i<farts.size(); i++){
		part fp = farts[i];
		glColor4f(fp.r, fp.g, fp.b, fp.a);
		glVertex3d(fp.x, fp.y, fp.z);
		glVertex3d(fp.x-fp.vx, fp.y-fp.vy, fp.z-fp.vz);
	}

	glNormal3d(0,1.5,0);
	for(int i=0; i<sparts.size(); i++){
		part fp = sparts[i];
		glColor4f(fp.r, fp.g, fp.b, fp.a);
		glVertex3d(fp.x, fp.y, fp.z);
		glVertex3d(fp.x-fp.vx, fp.y-fp.vy, fp.z-fp.vz);
	}

	glNormal3d(0,1,0);
	for(int i=0; i<smarts.size(); i++){
		part fp = smarts[i];
		glColor4f(fp.r, fp.g, fp.b, fp.a);
		glVertex3d(fp.x, fp.y, fp.z);
		glVertex3d(fp.x-fp.vx, fp.y-fp.vy, fp.z-fp.vz);
	}
	glEnd();
}

#endif